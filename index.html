<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<title>It's Science (Trivia)</title>

		<!-- Bootstrap -->
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

		<link href="https://fonts.googleapis.com/css?family=Inconsolata" rel="stylesheet">

		<!-- jQuery -->
    	<script type="text/javascript" src="https://code.jquery.com/jquery-2.2.0.js"></script>

    	<!-- https://opentdb.com/api.php?amount=25&category=18&difficulty=medium&type=multiple -->

    	<!-- https://opentdb.com/api.php?amount=25&category=18&difficulty=medium&type=easy -->

		<style>
			body {
				background-image: url('assets/images/science.png');
				font-family: 'Inconsolata', monospace, 'Lato', 'Helvetica Neue', Helvetica, Arial, sans-serif;
				font-size: 36px;
			}
			.textbox {
				background-color: #111466;
				color: white;
				text-align: center;
				margin-top: 50px;
				padding: 24px;
				height: 700px;
			}
			.title {
				font-size: 48px;
				margin-bottom: 36px;
			}
			.time {
				height: 36px;
				margin-bottom: 12px;
			}
			.startbtn {
				width: 40%;
				color: #111466;
				margin-top: 200px;
			}
			.answerbtn {
				width: 50%;
				color: white;
				border-style: none;
				background-color: #111466;
			}
			.answerbtn:hover {
				background-color: blue;
			}

		</style>

	</head>

	<body>

		<div class="container-fluid">
			<div class="col-lg-8 col-lg-offset-2 textbox">
				<div class="title">You Blinded Me with Science... Trivia!!!</div>
				<div class="time" id="time"></div>
				<div class="question" id="question"></div>
				<button class="startbtn" id='start'>Start</button>
			</div>
		</div>


		<!-- Javascript -->
		<script>

			// Global array to store questions (should not be altered)
			var QUESTIONSARRAY = [];

			
			// Question Object
			function Question(x) {
				this.questionTime = 20,
				this.questionInterval = null;
				this.quTimeRunning = false,

				this.question = x.question,
				this.correct_answer = x.correct_answer, 
				this.incorrect_answers = x.incorrect_answers
			};
			
			// Question object
			var triviaGame = {
				transitionTime: null,
				transitionInterval: null,
				tranTimeRunning: false,
				questions: [],
				currentQuestion: null,
				guessed: false,
				wins: 0,
				loses: 0,

				init: function () {
					this.questions = QUESTIONSARRAY;

				},

				start: function () {

					this.transitionTime = 4;
					this.transitionInterval = null;
					this.tranTimeRunning = false;
					this.guessed = false;

					$.when(this.getQuestion(this.questions)).done(this.setTimer());
        			
				},

				getQuestion: function (quArray) {

					var randomIndex = Math.floor(Math.random() * quArray.length);
					this.currentQuestion = quArray[randomIndex];
					// delete question from array
					console.log(this.currentQuestion);
				},

				displayQuestion: function () {
					$('#question').empty();

					$('#question').append('<p>' + this.currentQuestion.question + '</p>');

					$('#question').append(
						'<div><button class="answerbtn" id="answerbtn" data-name="correct">' 
						+ this.currentQuestion.correct_answer + '</button></div>');

					for (var i = 0; i < this.currentQuestion.incorrect_answers.length; i++) {
						$('#question').append(
							'<div><button class="answerbtn" id="answerbtn" data-name="incorrect">' 
							+ this.currentQuestion.incorrect_answers[i] + '</button></div>');
					}	
				},

				setTimer: function () {

					$('#time').html('<p>Time Remaining: 10 second(s)</p>');
					if (!triviaGame.currentQuestion.quTimeRunning) {
					 	this.displayQuestion();
         				triviaGame.currentQuestion.questionInvertval = setInterval(triviaGame.count, 1000);
         				this.currentQuestion.quTimeRunning = true;
         			}
				},

				count: function() {

					$('#time').html('<p>Time Remaining: ' + triviaGame.currentQuestion.questionTime + ' second(s)</p>');
					
					if(triviaGame.currentQuestion.questionTime === 0) {
						console.log('outof time');
						triviaGame.outOfTime();
					}
					//console.log(triviaGame.currentQuestion.questionTime);

					triviaGame.currentQuestion.questionTime--;
				},

				checkAnswer: function(answer){
					clearInterval(triviaGame.currentQuestion.questionInvertval);
					this.tranTimeRunning = true;

					if(answer === 'correct') {
						this.wins++;
						triviaGame.transitionInterval = setInterval(triviaGame.displayCorrectGuess, 1000);

					}
					else {
						this.loses++;
						triviaGame.transitionInterval = setInterval(triviaGame.displayIncorrectGuess, 1000);

					}
					console.log(answer);
				},

				displayCorrectGuess: function(){
					$('#question').empty();

					$('#question').append('<p>CORRECT!</p>');

					if(triviaGame.transitionTime === 0) {
						clearInterval(triviaGame.transitionInterval);
						triviaGame.start();
					}
					console.log(triviaGame.transitionTime);
					triviaGame.transitionTime--;
				},

				displayIncorrectGuess: function(){
					$('#question').empty();

					$('#question').append('<p>Sorry, that was incorrect!</p><p>The correct answer is ' + triviaGame.currentQuestion.correct_answer + '</p>');

					if(triviaGame.transitionTime === 0) {
						clearInterval(triviaGame.transitionInterval);
						triviaGame.start();
					}

					triviaGame.transitionTime--;
				},

				outOfTime: function () {
					clearInterval(triviaGame.currentQuestion.questionInvertval);
    				triviaGame.currentQuestion.quTimeRunning = false;
    				
    				triviaGame.transitionInterval = setInterval(triviaGame.displayOutOfTime, 1000);

    				loses++;
				},

				displayOutOfTime: function () {
					$('#question').html('<p>Out of Time!</p>');

					if(triviaGame.transitionTime === 0) {
						clearInterval(triviaGame.transitionInterval);
						triviaGame.start();
					}

					triviaGame.transitionTime--;
				}
			};

			$(document).ready( function(){

				// initializes our trivia game
				triviaGame.init();

				// Click Functions
				$('#start').on('click', function(e) {
					$('#start').hide();
					triviaGame.start();
				});

				$('#question').on('click', '#answerbtn', function(e) {
					if(!triviaGame.guessed) {
						triviaGame.guessed = true;
						triviaGame.checkAnswer($(this).attr('data-name'));
					}
				});

				// API calls, just loads once when page refreshed
				$.ajax({
					url: 'https://opentdb.com/api.php?amount=25&category=18&difficulty=easy&type=multiple',
					method: "GET"
				}).done(function(response) {
					for(var i = 0; i < response.results.length; i++) {
						var m = new Question(response.results[i]);
						QUESTIONSARRAY.push(m);
					}
					$.ajax({
						url: 'https://opentdb.com/api.php?amount=25&category=18&difficulty=medium&type=multiple',
						method: "GET"
					}).done(function(response) {
						for(var j = 0; j < response.results.length; j++) {
							var n = new Question(response.results[j]);
							QUESTIONSARRAY.push(n);
						}
					});
					console.log(QUESTIONSARRAY);
				});

				



			// randomize answers- 
			// var correctAnsLocation = Math.floor(Math.random()*3);
			// for (var i = 0; i < incorrect_answers.length; i++) {
			// 		if (correctAnsLocation === i) {
			//			append correct
			// 		}
			//		append incorrect
		});

		</script>

		
		
	</body>
</html>





